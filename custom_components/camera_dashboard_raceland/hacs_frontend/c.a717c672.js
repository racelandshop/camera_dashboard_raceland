import{aD as e}from"./c.5a5021e9.js";import{_ as o,p as t,g as r,t as i,k as d,l as a,c as s,f as n,o as l,q as h}from"./main-b570e60a.js";const c=(o,t)=>{if(!(t instanceof e))return{warnings:[t.message],errors:void 0};const r=[],i=[];for(const e of t.failures())if(void 0===e.value)r.push(o.localize("ui.errors.config.key_missing","key",e.path.join(".")));else if("never"===e.type)i.push(o.localize("ui.errors.config.key_not_expected","key",e.path.join(".")));else{if("union"===e.type)continue;"enums"===e.type?i.push(o.localize("ui.errors.config.key_wrong_type","key",e.path.join("."),"type_correct",e.message.replace("Expected ","").split(", ")[0],"type_wrong",JSON.stringify(e.value))):i.push(o.localize("ui.errors.config.key_wrong_type","key",e.path.join("."),"type_correct",e.refinement||e.type,"type_wrong",JSON.stringify(e.value)))}return{warnings:i,errors:r}};let u;const y={key:"Mod-s",run:e=>(n(e.dom,"editor-save"),!0)};o([h("ha-code-editor")],(function(e,o){class t extends o{constructor(...o){super(...o),e(this)}}return{F:t,d:[{kind:"field",key:"codemirror",value:void 0},{kind:"field",decorators:[r()],key:"mode",value:()=>"yaml"},{kind:"field",key:"hass",value:void 0},{kind:"field",decorators:[r({type:Boolean})],key:"autofocus",value:()=>!1},{kind:"field",decorators:[r({type:Boolean})],key:"readOnly",value:()=>!1},{kind:"field",decorators:[r({type:Boolean,attribute:"autocomplete-entities"})],key:"autocompleteEntities",value:()=>!1},{kind:"field",decorators:[r()],key:"error",value:()=>!1},{kind:"field",decorators:[i()],key:"_value",value:()=>""},{kind:"field",key:"_loadedCodeMirror",value:void 0},{kind:"set",key:"value",value:function(e){this._value=e}},{kind:"get",key:"value",value:function(){return this.codemirror?this.codemirror.state.doc.toString():this._value}},{kind:"get",key:"hasComments",value:function(){if(!this.codemirror||!this._loadedCodeMirror)return!1;const e=this._loadedCodeMirror.HighlightStyle.get(this.codemirror.state,this._loadedCodeMirror.tags.comment);return!!this.shadowRoot.querySelector(`span.${e}`)}},{kind:"method",key:"connectedCallback",value:function(){d(a(t.prototype),"connectedCallback",this).call(this),this.codemirror&&!1!==this.autofocus&&this.codemirror.focus()}},{kind:"method",key:"update",value:function(e){d(a(t.prototype),"update",this).call(this,e),this.codemirror&&(e.has("mode")&&this.codemirror.dispatch({effects:this._loadedCodeMirror.langCompartment.reconfigure(this._mode)}),e.has("readOnly")&&this.codemirror.dispatch({effects:this._loadedCodeMirror.readonlyCompartment.reconfigure(this._loadedCodeMirror.EditorView.editable.of(!this.readOnly))}),e.has("_value")&&this._value!==this.value&&this.codemirror.dispatch({changes:{from:0,to:this.codemirror.state.doc.length,insert:this._value}}),e.has("error")&&this.classList.toggle("error-state",this.error))}},{kind:"method",key:"firstUpdated",value:function(e){d(a(t.prototype),"firstUpdated",this).call(this,e),this._blockKeyboardShortcuts(),this._load()}},{kind:"get",key:"_mode",value:function(){return this._loadedCodeMirror.langs[this.mode]}},{kind:"method",key:"_load",value:async function(){this._loadedCodeMirror=await(async()=>(u||(u=import("./c.e9b85c04.js")),u))();const e=[this._loadedCodeMirror.lineNumbers(),this._loadedCodeMirror.EditorState.allowMultipleSelections.of(!0),this._loadedCodeMirror.history(),this._loadedCodeMirror.highlightSelectionMatches(),this._loadedCodeMirror.highlightActiveLine(),this._loadedCodeMirror.drawSelection(),this._loadedCodeMirror.rectangularSelection(),this._loadedCodeMirror.keymap.of([...this._loadedCodeMirror.defaultKeymap,...this._loadedCodeMirror.searchKeymap,...this._loadedCodeMirror.historyKeymap,...this._loadedCodeMirror.tabKeyBindings,y]),this._loadedCodeMirror.langCompartment.of(this._mode),this._loadedCodeMirror.theme,this._loadedCodeMirror.Prec.fallback(this._loadedCodeMirror.highlightStyle),this._loadedCodeMirror.readonlyCompartment.of(this._loadedCodeMirror.EditorView.editable.of(!this.readOnly)),this._loadedCodeMirror.EditorView.updateListener.of((e=>this._onUpdate(e)))];!this.readOnly&&this.autocompleteEntities&&this.hass&&e.push(this._loadedCodeMirror.autocompletion({override:[this._entityCompletions.bind(this)],maxRenderedOptions:10})),this.codemirror=new this._loadedCodeMirror.EditorView({state:this._loadedCodeMirror.EditorState.create({doc:this._value,extensions:e}),root:this.shadowRoot,parent:this.shadowRoot})}},{kind:"field",key:"_getStates",value:()=>s((e=>{if(!e)return[];return Object.keys(e).map((o=>({type:"variable",label:o,detail:e[o].attributes.friendly_name,info:`State: ${e[o].state}`})))}))},{kind:"method",key:"_entityCompletions",value:function(e){const o=e.matchBefore(/[a-z_]{3,}\./);if(!o||o.from===o.to&&!e.explicit)return null;const t=this._getStates(this.hass.states);return t&&t.length?{from:Number(o.from),options:t,span:/^\w*.\w*$/}:null}},{kind:"method",key:"_blockKeyboardShortcuts",value:function(){this.addEventListener("keydown",(e=>e.stopPropagation()))}},{kind:"method",key:"_onUpdate",value:function(e){if(!e.docChanged)return;const o=this.value;o!==this._value&&(this._value=o,n(this,"value-changed",{value:this._value}))}},{kind:"get",static:!0,key:"styles",value:function(){return l`
      :host(.error-state) .cm-gutters {
        border-color: var(--error-state-color, red);
      }
    `}}]}}),t);export{c as h};

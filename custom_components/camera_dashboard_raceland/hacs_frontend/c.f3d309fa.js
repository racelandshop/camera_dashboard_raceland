import{_ as t,p as e,g as i,t as s,k as n,l as r}from"./main-b570e60a.js";import{W as a,aa as o,U as l,ab as d}from"./c.4d0662f5.js";import"./c.84af24de.js";import"./c.17776df6.js";import"./c.5a5021e9.js";import"./c.2aff7a3c.js";import"./c.309a65b6.js";import"./c.bc207e00.js";const h=(t,e)=>{var i;const s=e.operator||"==",n=null!==(i=e.value)&&void 0!==i?i:e,r=e.attribute?t.attributes[e.attribute]:t.state;switch(s){case"==":return r===n;case"<=":return r<=n;case"<":return r<n;case">=":return r>=n;case">":return r>n;case"!=":return r!==n;case"in":return!(!Array.isArray(n)&&"string"!=typeof n)&&n.includes(r);case"not in":return!(!Array.isArray(n)&&"string"!=typeof n)&&!n.includes(r);case"regex":return null!==r&&"object"==typeof r?RegExp(n).test(JSON.stringify(r)):RegExp(n).test(r);default:return!1}};let f=t(null,(function(t,e){class f extends e{constructor(...e){super(...e),t(this)}}return{F:f,d:[{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,i){const s=a(t,3,e,i,["light","switch","sensor"]);return{type:"entity-filter",entities:s,state_filter:[s[0]?t.states[s[0]].state:""],card:{type:"entities"}}}},{kind:"field",decorators:[i({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[i()],key:"isPanel",value:()=>!1},{kind:"field",decorators:[i()],key:"editMode",value:()=>!1},{kind:"field",decorators:[s()],key:"_config",value:void 0},{kind:"field",key:"_element",value:void 0},{kind:"field",key:"_configEntities",value:void 0},{kind:"field",key:"_baseCardConfig",value:void 0},{kind:"field",key:"_oldEntities",value:void 0},{kind:"method",key:"getCardSize",value:function(){return this._element?o(this._element):1}},{kind:"method",key:"setConfig",value:function(t){if(!t.entities.length||!Array.isArray(t.entities))throw new Error("Entities must be specified");if(!(t.state_filter&&Array.isArray(t.state_filter)||t.entities.every((t=>"object"==typeof t&&t.state_filter&&Array.isArray(t.state_filter)))))throw new Error("Incorrect filter config");this._configEntities=l(t.entities),this._config=t,this._baseCardConfig={type:"entities",entities:[],...this._config.card},this.lastChild&&this.removeChild(this.lastChild),this._element=this._createCardElement(this._baseCardConfig)}},{kind:"method",key:"createRenderRoot",value:function(){return this}},{kind:"method",key:"shouldUpdate",value:function(t){return this._element&&(this._element.hass=this.hass,this._element.editMode=this.editMode,this._element.isPanel=this.isPanel),!!t.has("_config")||!!t.has("hass")&&this._haveEntitiesChanged(t.get("hass"))}},{kind:"method",key:"update",value:function(t){if(n(r(f.prototype),"update",this).call(this,t),!(this.hass&&this._config&&this._configEntities&&this._element))return;const e=this._configEntities.filter((t=>{const e=this.hass.states[t.entity];if(!e)return!1;if(t.state_filter){for(const i of t.state_filter)if(h(e,i))return!0}else for(const t of this._config.state_filter)if(h(e,t))return!0;return!1}));if(0!==e.length||!1!==this._config.show_empty){if(this.lastChild){if("HUI-ERROR-CARD"!==this._element.tagName){this._oldEntities&&e.length===this._oldEntities.length&&e.every(((t,e)=>t===this._oldEntities[e]))||(this._oldEntities=e,this._element.setConfig({...this._baseCardConfig,entities:e}))}}else this._element.setConfig({...this._baseCardConfig,entities:e}),this._oldEntities=e;this.lastChild||this.appendChild(this._element),this.style.display="block"}else this.style.display="none"}},{kind:"method",key:"_haveEntitiesChanged",value:function(t){if(!this.hass||!t)return!0;if(!this._configEntities)return!0;if(this.hass.localize!==t.localize)return!0;for(const e of this._configEntities)if(this.hass.states[e.entity]!==t.states[e.entity])return!0;return!1}},{kind:"method",key:"_createCardElement",value:function(t){const e=d(t);return this.hass&&(e.hass=this.hass),e.isPanel=this.isPanel,e.editMode=this.editMode,e.addEventListener("ll-rebuild",(i=>{i.stopPropagation(),this._rebuildCard(e,t)}),{once:!0}),e}},{kind:"method",key:"_rebuildCard",value:function(t,e){const i=this._createCardElement(e);t.parentElement&&t.parentElement.replaceChild(i,t),this._element=i}}]}}),e);customElements.define("hui-entity-filter-card",f);
